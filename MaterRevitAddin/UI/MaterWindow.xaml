<Window x:Class="Mater2026.UI.MaterWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mater 2026" Width="1280" Height="860"
        WindowStartupLocation="CenterOwner">


    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="Bool2Vis"/>

        <!-- Folder tile -->
        <DataTemplate x:Key="FolderTileTemplate">
            <Border Margin="6" Padding="6" BorderBrush="#555" BorderThickness="1" CornerRadius="8"
                    ContextMenuOpening="FolderTile_ContextMenuOpening">
                <StackPanel>
                    <Border Background="#111" Width="160" Height="160" CornerRadius="6">
                        <Image Stretch="UniformToFill" Source="{Binding ThumbPath}"/>
                    </Border>
                    <TextBlock Text="{Binding Name}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- File tile (overlay) -->
        <DataTemplate x:Key="FileTileTemplate">
            <Border Margin="6" Padding="6" BorderBrush="#444" BorderThickness="1" CornerRadius="6">
                <StackPanel>
                    <Image Width="120" Height="120" Stretch="UniformToFill"
                           Source="{Binding FullPath}"
                           Tag="{Binding FullPath}"
                           MouseLeftButtonDown="ImageItem_MouseLeftButtonDown"
                           PreviewMouseMove="ImageItem_PreviewMouseMove"
                           ContextMenuOpening="ImageItem_ContextMenuOpening"/>
                    <TextBlock Text="{Binding FileName}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="200"/>
        </Grid.ColumnDefinitions>

        <!-- ========== LEFT COLUMN ========== -->
        <DockPanel Grid.Column="0" Margin="5">
            <!-- Root picker + Tree -->
            <StackPanel Margin="0,0,0,8" Orientation="Vertical">
                <TextBlock FontWeight="Bold" Text="Library" Height="20"/>
                <StackPanel Orientation="Horizontal" Height="20">
                    <Button x:Name="BtnPickRoot" Content="Choisir…" Click="BtnPickRoot_Click"
                            BorderBrush="{x:Null}" Background="{x:Null}" Padding="0"/>
                    <TextBox x:Name="RootBox" Margin="6,0,0,0" IsReadOnly="True"
                             BorderThickness="0" Width="137"/>
                </StackPanel>

                <TreeView x:Name="Tree"
                          Height="300"
                          SelectedItemChanged="Tree_SelectedItemChanged"
                          VirtualizingStackPanel.IsVirtualizing="True"
                          VirtualizingStackPanel.VirtualizationMode="Recycling"
                          ScrollViewer.CanContentScroll="True"
                          BorderBrush="#FF005BFF" Padding="1,1,1,10"/>

                <TextBlock Text="Project Material List" FontWeight="Bold"/>
                <!-- If ItemsSource = tuple: use DisplayMemberPath="Item2" SelectedValuePath="Item1" -->
                <ListBox x:Name="MatList"
                         DisplayMemberPath="Name"
                         SelectedValuePath="Id"
                         SelectionChanged="MatList_SelectionChanged"
                         Height="400" BorderBrush="#FFFFBB00"/>
                <Button x:Name="PipetteBtn" Content="Pipette" Click="PipetteBtn_Click" Width="100"/>
                <Button x:Name="AssignBtn" Content="Assigner" Click="AssignBtn_Click"
                        IsEnabled="False" Width="100"/>
            </StackPanel>
        </DockPanel>

        <!-- ========== CENTER COLUMN ========== -->
        <DockPanel Grid.Column="1" Margin="5">
            <!-- Toolbar -->
            <StackPanel DockPanel.Dock="Top" Height="40">
                <TextBlock FontWeight="Bold" HorizontalAlignment="Left" Height="20">
                    <Run Language="fr-fr" Text="Thumbnails"/>
                </TextBlock>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,6" Width="331" Height="20">
                    <ComboBox x:Name="ThumbSizeDrop"
                              SelectionChanged="ThumbSizeDrop_SelectionChanged"
                              Width="100" Padding="0" BorderThickness="0" BorderBrush="{x:Null}"/>
                    <Button x:Name="GenMissing" Content="Generate" Click="GenMissing_Click"
                            Background="{x:Null}" BorderBrush="{x:Null}"/>
                    <ToggleButton x:Name="ToggleGalleryBtn" Content="Galerie ↔ Thumbnails" Margin="12,0,0,0"
                                  Click="ToggleGallery_Click" Visibility="Collapsed"/>
                </StackPanel>
            </StackPanel>

            <!-- Files overlay (top of grid) -->
            <Border x:Name="FilesOverlay"
                    DockPanel.Dock="Top"
                    Background="#D0151515"
                    Padding="10"
                    Visibility="Collapsed">
                <StackPanel>
                    <DockPanel Margin="0,0,0,8">
                        <TextBlock Text="{Binding ElementName=FilesList, Path=Items.Count, StringFormat=Fichiers ({0})}"
                                   FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button Content="Fermer" DockPanel.Dock="Right"
                                Click="FilesOverlay_Close_Click" Padding="6,2" Margin="8,0,0,0"/>
                    </DockPanel>

                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" Height="220">
                        <ItemsControl x:Name="FilesList" ItemTemplate="{StaticResource FileTileTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </Border>

        </DockPanel>

        <!-- ========== RIGHT COLUMN ========== -->
        <StackPanel Grid.Column="2" Margin="5" HorizontalAlignment="Right">
            <TextBlock Text="Paramètres" FontWeight="Bold" Height="20"/>

            <TextBlock Text="Maps" Height="20"/>
            <!-- RIGHT COLUMN -->
            <ItemsControl x:Name="MapTypesList" Grid.Column="2" Margin="5" HorizontalContentAlignment="Stretch">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,8" Padding="0,0,0,8" BorderBrush="#333" BorderThickness="0,0,0,1"
                        AllowDrop="True" DragOver="MapSlot_DragOver" Drop="MapSlot_Drop"
                        ContextMenuOpening="MapSlot_ContextMenuOpening">
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayName}" FontWeight="Bold" Margin="0,0,0,6"/>
                                <Border Height="100" Background="#111">
                                    <Image Stretch="UniformToFill" Source="{Binding Assigned.FullPath}"/>
                                </Border>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <Button x:Name="TintBtn" Content="Teinte" Width="190" Click="TintBtn_Click" Height="20" BorderBrush="Black" Background="White"/>
            <TextBlock Text="Nom (apparence)" Margin="0,6,0,0"/>
            <TextBox x:Name="MatNameBox" TextChanged="MatNameBox_TextChanged"
                     VerticalAlignment="Center" BorderBrush="Black" BorderThickness="0,0,0,1"/>

            <TextBlock Text="Dossier sélectionné" Margin="0,20,0,0"/>
            <TextBox x:Name="FolderBox" IsReadOnly="True" BorderThickness="0,0,0,1" BorderBrush="Black"/>

            <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                <StackPanel Width="95">
                    <TextBlock Text="Largeur (cm)"/>
                    <TextBox x:Name="WidthBox" Text="300" BorderThickness="0,0,0,1" BorderBrush="Black"/>
                </StackPanel>
                <StackPanel Width="95">
                    <TextBlock Text="Hauteur (cm)"/>
                    <TextBox x:Name="HeightBox" Text="300" BorderThickness="0,0,0,1" BorderBrush="Black"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                <StackPanel Width="95">
                    <TextBlock Text="Tiles X"/>
                    <TextBox x:Name="TilesXBox" Text="1" BorderThickness="1,1,0,1"/>
                </StackPanel>
                <StackPanel Width="95">
                    <TextBlock Text="Tiles Y"/>
                    <TextBox x:Name="TilesYBox" Text="1" BorderThickness="0,1,1,1"/>
                </StackPanel>
            </StackPanel>

            <TextBlock Text="Rotation (°)" Margin="0,6,0,0"/>
            <TextBox x:Name="RotBox" Text="0"/>

            <StackPanel Margin="0,10,0,0" Orientation="Horizontal">
                <Button x:Name="CreateBtn"  Content="Créer"     Width="90" Click="CreateBtn_Click"/>
                <Button x:Name="ReplaceBtn" Content="Remplacer" Width="90" Margin="8,0,0,0" Click="ReplaceBtn_Click"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
