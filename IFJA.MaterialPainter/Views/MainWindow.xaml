<Window x:Class="MaterRevitAddin.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Material Painter (Générique) - Revit 2026 (.NET 8, Win11)"
        Height="860" Width="1420" KeyDown="Window_KeyDown">
  <Grid Margin="10">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="2.2*"/>
      <ColumnDefinition Width="3.6*"/>
      <ColumnDefinition Width="3.2*"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Colonne gauche -->
    <DockPanel Grid.Column="0" Grid.RowSpan="2" Margin="0,0,10,0">
      <GroupBox Header="Bibliothèque textures" Margin="0,0,0,8">
        <TreeView x:Name="FolderTree"
                  SelectedItemChanged="FolderTree_SelectedItemChanged"
                  AllowDrop="True"
                  PreviewDragOver="Tree_PreviewDragOver"
                  Drop="Tree_Drop"
                  Margin="6"/>
      </GroupBox>

      <GroupBox Header="Collector (Projet)" Margin="0,0,0,8" DockPanel.Dock="Top">
        <TabControl x:Name="CollectorTabs" Margin="6">
          <TabItem Header="Matériaux">
            <ListView x:Name="MaterialsList" SelectionMode="Extended">
              <ListView.ContextMenu>
                <ContextMenu>
                  <MenuItem Header="Remplacer (Créer nouvelle apparence)" Command="{Binding ReplaceWithPrepared_NewCommand}"/>
                  <MenuItem Header="Écraser l'apparence existante" Command="{Binding ReplaceWithPrepared_OverwriteCommand}"/>
                  <Separator/>
                  <MenuItem Header="Renommer apparence liée" Command="{Binding RenameLinkedAppearanceCommand}"/>
                  <MenuItem Header="Sélectionner tous les éléments utilisant…" Command="{Binding SelectAllUsingSelectedMaterialsCommand}"/>
                </ContextMenu>
              </ListView.ContextMenu>
            </ListView>
          </TabItem>
          <TabItem Header="Apparences">
            <ListView x:Name="AppearancesList" SelectionMode="Extended">
              <ListView.ContextMenu>
                <ContextMenu>
                  <MenuItem Header="Remplacer (Créer nouvelle apparence)" Command="{Binding ReplaceWithPrepared_NewCommand}"/>
                  <MenuItem Header="Écraser cette apparence" Command="{Binding ReplaceWithPrepared_OverwriteCommand}"/>
                  <Separator/>
                  <MenuItem Header="Renommer cette apparence" Command="{Binding RenameAppearanceCommand}"/>
                  <MenuItem Header="Sélectionner tous les éléments utilisant…" Command="{Binding SelectAllUsingSelectedAppearancesCommand}"/>
                </ContextMenu>
              </ListView.ContextMenu>
            </ListView>
          </TabItem>
        </TabControl>
      </GroupBox>

      <StackPanel DockPanel.Dock="Bottom">
        <Button Content="Pipette (lecture-seule)" Height="36" x:Name="BtnPipette" Click="BtnPipette_Click"/>
      </StackPanel>
    </DockPanel>

    <!-- Colonne centrale: thumbnails + slots -->
    <Grid Grid.Column="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="2.2*"/>
      </Grid.RowDefinitions>

      <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
        <ListBox x:Name="GalleryCtrl" SelectionMode="Extended"
                 AllowDrop="True"
                 PreviewDragOver="Gallery_PreviewDragOver"
                 Drop="Gallery_Drop"
                 PreviewMouseLeftButtonDown="Gallery_PreviewMouseLeftButtonDown"
                 PreviewMouseMove="Gallery_PreviewMouseMove">
        </ListBox>
      </ScrollViewer>

      <Separator Grid.Row="1" Margin="0,6"/>

      <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
        <ItemsControl x:Name="SlotsCtrl"
                      AllowDrop="True"
                      PreviewDragOver="Slots_PreviewDragOver"
                      Drop="Slots_Drop"/>
      </ScrollViewer>
    </Grid>

    <!-- Colonne droite: propriétés + actions -->
    <StackPanel Grid.Column="2">
      <GroupBox Header="Propriétés matériau" Margin="0,0,0,8">
        <StackPanel Margin="10">
          <WrapPanel>
            <TextBlock Text="Nom matériau:" VerticalAlignment="Center"/>
            <TextBox Width="220" Margin="6,0" Text="{Binding MaterialName}"/>
            <TextBlock Text="Apparence:" Margin="12,0,0,0" VerticalAlignment="Center"/>
            <TextBox Width="220" Margin="6,0" Text="{Binding AppearanceName}"/>
          </WrapPanel>
          <WrapPanel Margin="6,8,0,0">
            <TextBlock Text="Chemin (Description):" VerticalAlignment="Center"/>
            <TextBox Width="420" Margin="6,0" Text="{Binding Description}"/>
          </WrapPanel>
          <CheckBox Content="Verrouiller tailles/rotation (hériter Diffuse)" IsChecked="{Binding GlobalLockInheritDiffuse}" Margin="0,10,0,0"/>
          <WrapPanel Margin="0,6,0,0">
            <TextBlock Text="Diffuse X (m):" VerticalAlignment="Center"/>
            <TextBox Width="70" Text="{Binding RealWorldSizeX}"/>
            <TextBlock Text="  Y (m):" VerticalAlignment="Center"/>
            <TextBox Width="70" Text="{Binding RealWorldSizeY}"/>
            <TextBlock Text="  Rot (°):" VerticalAlignment="Center"/>
            <TextBox Width="70" Text="{Binding RotationAngle}"/>
          </WrapPanel>
        </StackPanel>
      </GroupBox>

      <GroupBox Header="Pattern (divisions)" Margin="0,0,0,8">
        <WrapPanel Margin="10">
          <TextBlock Text="Div X:" VerticalAlignment="Center"/>
          <TextBox Width="60" Text="{Binding DivX}"/>
          <TextBlock Text="  Div Y:" VerticalAlignment="Center" Margin="12,0,0,0"/>
          <TextBox Width="60" Text="{Binding DivY}"/>
          <Button Content="Créer/MAJ motif" Margin="12,0,0,0" Command="{Binding CreatePatternFromDivisionsCommand}"/>
        </WrapPanel>
      </GroupBox>

      <GroupBox Header="Graphismes" Margin="0,0,0,8">
        <StackPanel Margin="10">
          <CheckBox Content="Fond plein = teinte (surface background)" IsChecked="{Binding UseTintBackground}"/>
          <Button Content="Choisir teinte…" Margin="0,6,0,0"/>
        </StackPanel>
      </GroupBox>

      <StackPanel Orientation="Horizontal">
        <Button Content="Créer / Remplacer" Command="{Binding DoPrimaryActionCommand}" FontWeight="Bold"/>
        <Button Content="Copier" Margin="8,0,0,0" Command="{Binding CopyMaterialCommand}"/>
        <Button Content="Peindre faces…" Margin="8,0,0,0" Command="{Binding StartPaintSessionCommand}"/>
      </StackPanel>
    </StackPanel>
  </Grid>
</Window>
